{"version":3,"file":"ValidationPipe.js","sourceRoot":"","sources":["../../../src/mvc/pipes/ValidationPipe.ts"],"names":[],"mappings":";;;AAAA,iCAAoC;AACpC,+EAA0E;AAE1E,qEAAgE;AAKhE,IAAa,cAAc,GAA3B,MAAa,cAAc;IACzB,YAAsB,iBAAoC;QAApC,sBAAiB,GAAjB,iBAAiB,CAAmB;IAAG,CAAC;IAE9D,SAAS,CAAC,KAAU,EAAE,QAAuB;QAC3C,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAEtC,IAAI,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE;YACjC,MAAM,EAAC,cAAc,EAAC,GAAG,QAAQ,CAAC;YAClC,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,IAAI,QAAQ,CAAC,cAAc,CAAC;YAEtD,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,KAAK,EAAE,IAAI,EAAE,cAAc,CAAC,CAAC;SAC9D;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAES,cAAc,CAAC,KAAoB;QAC3C,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;IAChD,CAAC;IAES,eAAe,CAAC,KAAU,EAAE,QAAuB;QAC3D,IAAI,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE;YAC9B,MAAM,iDAAuB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC9C;QAED,OAAO,IAAI,CAAC;IACd,CAAC;CACF,CAAA;AA3BY,cAAc;IAH1B,eAAU,CAAC;QACV,IAAI,EAAE,WAAW;KAClB,CAAC;6CAEyC,qCAAiB;GAD/C,cAAc,CA2B1B;AA3BY,wCAAc","sourcesContent":["import {Injectable} from \"@tsed/di\";\nimport {RequiredValidationError} from \"../errors/RequiredValidationError\";\nimport {IPipe, ParamMetadata} from \"../models/ParamMetadata\";\nimport {ValidationService} from \"../services/ValidationService\";\n\n@Injectable({\n  type: \"validator\"\n})\nexport class ValidationPipe implements IPipe {\n  constructor(protected validationService: ValidationService) {}\n\n  transform(value: any, metadata: ParamMetadata) {\n    this.checkIsRequired(value, metadata);\n\n    if (this.shouldValidate(metadata)) {\n      const {collectionType} = metadata;\n      const type = metadata.type || metadata.collectionType;\n\n      this.validationService.validate(value, type, collectionType);\n    }\n\n    return value;\n  }\n\n  protected shouldValidate(param: ParamMetadata) {\n    return !!(param.type || param.collectionType);\n  }\n\n  protected checkIsRequired(value: any, metadata: ParamMetadata) {\n    if (metadata.isRequired(value)) {\n      throw RequiredValidationError.from(metadata);\n    }\n\n    return true;\n  }\n}\n"]}