{"version":3,"file":"SendResponseMiddleware.js","sourceRoot":"","sources":["../../../src/platform/middlewares/SendResponseMiddleware.ts"],"names":[],"mappings":";;;AAAA,qCAAmE;AACnE,iDAAkD;AAClD,sEAAiE;AACjE,iEAAwD;AACxD,mEAAyD;AAGzD;;;GAGG;AAEH,IAAa,sBAAsB,GAAnC,MAAa,sBAAsB;IACjC,YAAsB,gBAAkC;QAAlC,qBAAgB,GAAhB,gBAAgB,CAAkB;IAAG,CAAC;IAErD,GAAG,CAAQ,GAAQ,EAAS,QAAa;QAC9C,MAAM,EAAC,IAAI,EAAE,QAAQ,EAAC,GAAG,GAAG,CAAC,GAAG,CAAC;QACjC,IAAI,IAAI,KAAK,SAAS,EAAE;YACtB,OAAO,QAAQ,CAAC,IAAI,EAAE,CAAC;SACxB;QAED,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE;YAC/B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAEpB,OAAO,QAAQ,CAAC;SACjB;QAED,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;YAC3B,OAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC5B;QAED,OAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,EAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,EAAE,gBAAgB,EAAE,KAAK,EAAC,CAAC,CAAC,CAAC;IAC9G,CAAC;IAES,YAAY,CAAC,IAAS;QAC9B,OAAO,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,gBAAS,CAAC,IAAI,CAAC,IAAI,eAAQ,CAAC,IAAI,CAAC,IAAI,eAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,IAAI,CAAC;IACvG,CAAC;IAES,gBAAgB,CAAC,IAAS;QAClC,OAAO,eAAQ,CAAC,IAAI,CAAC,CAAC;IACxB,CAAC;CACF,CAAA;AA1BC;IAAY,mBAAA,aAAG,EAAE,CAAA,EAAY,mBAAA,cAAG,EAAE,CAAA;;;;iDAiBjC;AApBU,sBAAsB;IADlC,uBAAU,EAAE;6CAE6B,6BAAgB;GAD7C,sBAAsB,CA6BlC;AA7BY,wDAAsB","sourcesContent":["import {isBoolean, isNumber, isStream, isString} from \"@tsed/core\";\nimport {ConverterService} from \"../../converters\";\nimport {Middleware} from \"../../mvc/decorators/class/middleware\";\nimport {Req} from \"../../mvc/decorators/params/request\";\nimport {Res} from \"../../mvc/decorators/params/response\";\nimport {IMiddleware} from \"../../mvc/interfaces\";\n\n/**\n * See example to override SendResponseMiddleware [here](/docs/middlewares/override/send-response.md).\n * @middleware\n */\n@Middleware()\nexport class SendResponseMiddleware implements IMiddleware {\n  constructor(protected converterService: ConverterService) {}\n\n  public use(@Req() req: Req, @Res() response: Res) {\n    const {data, endpoint} = req.ctx;\n    if (data === undefined) {\n      return response.send();\n    }\n\n    if (this.shouldBeStreamed(data)) {\n      data.pipe(response);\n\n      return response;\n    }\n\n    if (this.shouldBeSent(data)) {\n      return response.send(data);\n    }\n\n    return response.json(this.converterService.serialize(data, {type: endpoint.type, withIgnoredProps: false}));\n  }\n\n  protected shouldBeSent(data: any) {\n    return Buffer.isBuffer(data) || isBoolean(data) || isNumber(data) || isString(data) || data === null;\n  }\n\n  protected shouldBeStreamed(data: any) {\n    return isStream(data);\n  }\n}\n"]}