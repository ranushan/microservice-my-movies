{"version":3,"file":"ServeStaticService.js","sourceRoot":"","sources":["../../../src/platform-express/services/ServeStaticService.ts"],"names":[],"mappings":";;;AAAA,iCAAiC;AACjC,mCAAmC;AAEnC,qFAAgF;AAEhF,SAAS,OAAO,CAAC,SAAiB;IAChC,MAAM,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IAE7C,OAAO,CAAC,OAAY,EAAE,QAAa,EAAE,IAAS,EAAE,EAAE;QAChD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE;YACzB,UAAU,CAAC,OAAO,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;SACrC;aAAM;YACL,IAAI,EAAE,CAAC;SACR;IACH,CAAC,CAAC;AACJ,CAAC;AAGD,IAAa,kBAAkB,GAA/B,MAAa,kBAAkB;IAC7B,YAAoB,mBAAwC;QAAxC,wBAAmB,GAAnB,mBAAmB,CAAqB;IAAG,CAAC;IAEhE,OAAO,CAAC,OAAgC;QACtC,0BAA0B;QAC1B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YAClC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAQ,CAAC,CAAC,OAAO,CAAC,CAAC,SAAiB,EAAE,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC;QAC9F,CAAC,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,IAAY,EAAE,SAAiB;QACnC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;IACzD,CAAC;CACF,CAAA;AAbY,kBAAkB;IAD9B,YAAO,EAAE;6CAEiC,yCAAmB;GADjD,kBAAkB,CAa9B;AAbY,gDAAkB","sourcesContent":["import {Service} from \"@tsed/di\";\nimport * as Express from \"express\";\nimport {IServerMountDirectories} from \"../../config\";\nimport {PlatformApplication} from \"../../platform/services/PlatformApplication\";\n\nfunction statics(directory: string) {\n  const middleware = Express.static(directory);\n\n  return (request: any, response: any, next: any) => {\n    if (!response.headersSent) {\n      middleware(request, response, next);\n    } else {\n      next();\n    }\n  };\n}\n\n@Service()\nexport class ServeStaticService {\n  constructor(private platformApplication: PlatformApplication) {}\n\n  statics(statics: IServerMountDirectories) {\n    /* istanbul ignore else */\n    Object.keys(statics).forEach(path => {\n      [].concat(statics[path] as any).forEach((directory: string) => this.mount(path, directory));\n    });\n  }\n\n  mount(path: string, directory: string) {\n    this.platformApplication.use(path, statics(directory));\n  }\n}\n"]}